<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Cloud Storage Configuration Form View -->
        <record id="view_cloud_storage_config_form" model="ir.ui.view">
            <field name="name">cloud.storage.config.form</field>
            <field name="model">cloud_storage.config</field>
            <field name="arch" type="xml">
                <form string="Cloud Storage Configuration" class="cloud_storage_scope">
                    <header>
                        <!-- Botones principales de sincronización -->
                        <button name="cloud_storage.action_manual_sync" type="action" string="Sincronizar Ahora"
                                class="oe_highlight"
                                attrs="{'invisible': [('is_active', '=', False)]}"
                                help="Sincroniza hasta 500 archivos pendientes"/>
                        <button name="cloud_storage.action_config_complete_sync" type="action" string="Sincronización Completa"
                                class="btn-primary"
                                attrs="{'invisible': [('is_active', '=', False)]}"
                                help="Sincroniza todos los archivos pendientes (puede tardar más tiempo)"/>

                        <!-- Botones de gestión de tokens -->
                        <button name="cloud_storage.action_config_check_tokens" type="action" string="Verificar Tokens"
                                class="btn-info"
                                help="Verifica y refresca automáticamente los tokens de autenticación"/>

                        <!-- Herramientas avanzadas -->
                        <button name="action_migrate_between_accounts" type="object" string="Migrar entre Cuentas"
                                class="btn-secondary" attrs="{'invisible': [('is_active', '=', False)]}"
                                help="Migra archivos entre diferentes cuentas de Google Drive"/>
                        <button name="action_restore_local_from_folder" type="object" string="Restaurar desde Drive"
                                class="btn-secondary" attrs="{'invisible': [('is_active', '=', False)]}"
                                help="Restaura archivos localmente desde una carpeta de Google Drive"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Nombre de la Configuración"/>
                            </h1>
                        </div>
                        <group>
                            <group string="Autenticación y Estado">
                                <field name="auth_id" string="Autenticación" options="{'no_create': True}"/>
                                <field name="is_active" string="Activo"/>
                                <field name="replace_local_with_cloud" string="Reemplazar Local con URLs Cloud"/>
                                <field name="delete_local_after_sync" string="Eliminar Archivos Locales Después de Sincronizar"/>
                            </group>
                            <group string="Sincronización Automática">
                                <field name="auto_sync" string="Sincronización Automática"/>
                                <field name="sync_frequency" string="Frecuencia de Sincronización" attrs="{'invisible': [('auto_sync', '=', False)]}"/>
                                 <field name="drive_root_folder_id" string="ID Carpeta Raíz de Drive" placeholder="ID de carpeta raíz (opcional)"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Configuración de Modelos">
                                <field name="model_config_ids" nolabel="1">
                                    <tree string="Modelos a Sincronizar" editable="bottom">
                                        <field name="model_name" string="Nombre del Modelo"/>
                                        <field name="display_name" string="Nombre para Mostrar"/>
                                        <field name="field_name" string="Campo de Adjunto"/>
                                        <field name="drive_folder_name" string="Nombre de Carpeta en Drive"/>
                                        <field name="is_active" string="Activo"/>
                                    </tree>
                                    <form string="Configuración de Modelo" class="cloud_storage_scope">
                                        <group>
                                            <field name="model_name" string="Nombre del Modelo"/>
                                            <field name="display_name" string="Nombre para Mostrar"/>
                                            <field name="field_name" string="Campo de Adjunto"/>
                                            <field name="drive_folder_name" string="Nombre de Carpeta en Drive"/>
                                            <field name="is_active" string="Activo"/>
                                        </group>
                                    </form>
                                </field>
                            </page>
                            <page string="Tipos de Archivo">
                                <field name="file_type_ids" nolabel="1">
                                    <tree string="Tipos de Archivo Permitidos" editable="bottom">
                                        <field name="extension" string="Extensión"/>
                                        <field name="description" string="Descripción"/>
                                        <field name="max_size_mb" string="Tamaño Máx. (MB)"/>
                                        <field name="is_active" string="Activo"/>
                                    </tree>
                                    <form string="Configuración de Tipo de Archivo" class="cloud_storage_scope">
                                        <group>
                                            <field name="extension" string="Extensión"/>
                                            <field name="description" string="Descripción"/>
                                            <field name="max_size_mb" string="Tamaño Máx. (MB)"/>
                                            <field name="is_active" string="Activo"/>
                                        </group>
                                    </form>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Wizard: Migrate Between Accounts -->
        <record id="view_cloud_storage_wizard_migrate_form" model="ir.ui.view">
            <field name="name">cloud.storage.wizard.migrate.form</field>
            <field name="model">cloud_storage.wizard.migrate</field>
            <field name="arch" type="xml">
                <form string="Migrar entre Cuentas de Drive" class="cloud_storage_scope">
                    <group>
                        <field name="source_auth_id" string="Autenticación Origen"/>
                        <field name="target_auth_id" string="Autenticación Destino"/>
                        <field name="source_folder_id" string="ID Carpeta Origen" placeholder="opcional"/>
                        <field name="target_folder_id" string="ID Carpeta Destino" placeholder="opcional"/>
                        <field name="recursive" string="Recursivo"/>
                        <field name="limit" string="Límite de Archivos"/>
                    <field name="verify_integrity" string="Verificar Integridad"/>
                    <field name="delete_source" string="Eliminar Archivos Origen"/>
                    <field name="delete_mode" string="Modo de Eliminación" attrs="{'invisible': [('delete_source','=',False)]}"/>
                    </group>
                    <footer>
                        <button string="Vista Previa" type="object" name="action_run" class="btn-secondary"/>
                        <button string="Ejecutar" type="object" name="action_run" class="btn-primary" context="{'confirmed': True}"/>
                        <button string="Cancelar" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Wizard: Restore Local From Folder -->
        <record id="view_cloud_storage_wizard_restore_form" model="ir.ui.view">
            <field name="name">cloud.storage.wizard.restore.form</field>
            <field name="model">cloud_storage.wizard.restore</field>
            <field name="arch" type="xml">
                <form string="Restaurar Archivos desde Drive" class="cloud_storage_scope">
                    <group>
                        <field name="auth_id" string="Autenticación"/>
                        <field name="folder_id" string="ID de Carpeta Drive"/>
                        <field name="recursive" string="Recursivo"/>
                        <field name="link_existing" string="Vincular Existentes"/>
                        <field name="default_res_model" string="Modelo por Defecto" placeholder="ej. 'res.partner'"/>
                        <field name="default_res_id" string="ID de Registro por Defecto"/>
                        <field name="limit" string="Límite de Archivos"/>
                    </group>
                    <footer>
                        <button string="Vista Previa" type="object" name="action_run" class="btn-secondary"/>
                        <button string="Ejecutar" type="object" name="action_run" class="btn-primary" context="{'confirmed': True}"/>
                        <button string="Cancelar" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Cloud Storage Configuration Tree View -->
        <record id="view_cloud_storage_config_tree" model="ir.ui.view">
            <field name="name">cloud.storage.config.tree</field>
            <field name="model">cloud_storage.config</field>
            <field name="arch" type="xml">
                <tree string="Configuraciones de Cloud Storage">
                    <field name="name" string="Nombre"/>
                    <field name="auth_id" string="Autenticación"/>
                    <field name="auto_sync" string="Sync Automático"/>
                    <field name="sync_frequency" string="Frecuencia"/>
                    <field name="is_active" string="Activo"/>
                </tree>
            </field>
        </record>

        <!-- Cloud Storage Configuration Action -->
        <record id="action_cloud_storage_config" model="ir.actions.act_window">
            <field name="name">Cloud Storage Configuration</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">cloud_storage.config</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first synchronization configuration!
                </p>
                <p>
                    Configure which models and file types should be synchronized with Google Drive.
                    Make sure to set up authentication first.
                </p>
            </field>
        </record>

        <!-- Model Configuration Tree View -->
        <record id="view_cloud_storage_model_config_tree" model="ir.ui.view">
            <field name="name">cloud.storage.model.config.tree</field>
            <field name="model">cloud_storage.model.config</field>
            <field name="arch" type="xml">
                <tree string="Model Configurations">
                    <field name="config_id"/>
                    <field name="display_name"/>
                    <field name="field_name"/>
                    <field name="drive_folder_name"/>
                    <field name="is_active"/>
                </tree>
            </field>
        </record>

        <!-- Model Configuration Action -->
        <record id="action_cloud_storage_model_config" model="ir.actions.act_window">
            <field name="name">Model Configurations</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">cloud_storage.model.config</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- File Type Tree View -->
        <record id="view_cloud_storage_file_type_tree" model="ir.ui.view">
            <field name="name">cloud.storage.file.type.tree</field>
            <field name="model">cloud_storage.file.type</field>
            <field name="arch" type="xml">
                <tree string="File Types">
                    <field name="config_id"/>
                    <field name="extension"/>
                    <field name="description"/>
                    <field name="max_size_mb"/>
                    <field name="is_active"/>
                </tree>
            </field>
        </record>

        <!-- File Type Action -->
        <record id="action_cloud_storage_file_type" model="ir.actions.act_window">
            <field name="name">File Types</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">cloud_storage.file.type</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- Actions moved to views/actions.xml -->

        <!-- Config: Check & Refresh Tokens Action -->
        <record id="action_config_check_tokens" model="ir.actions.server">
            <field name="name">Config: Check &amp; Refresh Tokens</field>
            <field name="model_id" ref="model_cloud_storage_config"/>
            <field name="state">code</field>
            <field name="code">action = model.action_check_and_refresh_tokens()</field>
        </record>

        <!-- Config: Force Refresh Tokens Action -->
        <record id="action_config_force_refresh" model="ir.actions.server">
            <field name="name">Config: Force Refresh Tokens</field>
            <field name="model_id" ref="model_cloud_storage_config"/>
            <field name="state">code</field>
            <field name="code">action = model.action_force_token_refresh()</field>
        </record>

        <!-- Config: Complete Sync Action -->
        <record id="action_config_complete_sync" model="ir.actions.server">
            <field name="name">Config: Complete Sync</field>
            <field name="model_id" ref="model_cloud_storage_config"/>
            <field name="state">code</field>
            <field name="code">action = model.complete_sync()</field>
        </record>
    </data>
</odoo>